<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chicago Air Quality Index</title>
    <script src="{{ url_for('static', filename='./d3/d3.min.js') }}"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='./css/style.css') }}">
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #FFFFFF;">
        <a class="navbar-brand" href="#">Chicago Air Quality Index</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="{{url_for('index')}}" tabindex="1">Home <span
                            class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{url_for('about')}}" tabindex="2">About the Project</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{url_for('paper')}}" tabindex="3">Read the Paper</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{url_for('poster')}}" tabindex="4">View the Poster</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{url_for('team')}}" tabindex="5">The Team</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                       data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Resources
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="http://www.omscs.gatech.edu/" target="_blank">Masters in
                            Analytics</a>
                        <a class="dropdown-item" href="https://pe.gatech.edu/degrees/analytics" target="_blank">Masters
                            in Computer Science</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="https://arrayofthings.github.io/" target="_blank">Array of
                            Things</a>
                        <a class="dropdown-item" href="http://elpc.org/issues/clean-air/air-quality-monitoring/"
                           target="_blank">ELPC</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="https://www.who.int/airpollution/en/" target="_blank">World
                            Health Organization (WHO)</a>
                        <a class="dropdown-item" href="https://19january2017snapshot.epa.gov/" target="_blank">EPA (2017
                            Archive)</a>
                        <a class="dropdown-item" href="https://www.epa.gov/" target="_blank">EPA.gov</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
</div>
{% block content%}{% endblock %}
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</body>

<script>
    let width = "100%";
    let height = 150;
    let health_height = height * 3;

    var svg = d3.select("#summaryChart").append("svg")
        .attr("width", "100%")
        .attr("height", height);


    var svg2 = d3.select("#healthChart").append("svg")
        .attr("width", "100%")
        .attr("height", health_height);

    data_package = {{ data_package | safe }}

    promises = [
        d3.csv("{{ url_for('static', filename='aqg.csv') }}"),
        JSON.parse(data_package[0]),
        JSON.parse(data_package[1])
    ];

    Promise.all(promises).then(function (data) {

        let limits = data[0];
        let zip_pollution = data[1];
        let zip_health = data[2];

        console.log(zip_pollution);
        console.log(zip_health);

        limits.forEach(function (d) {
            d.mortality = +d.mortality;
            d.value = +d.value;
        });

        let chartScale = d3.scaleLinear()
            .domain([0, 200])
            .range([0, 90]);

        let categoryScale = d3.scaleBand()
            .domain(['PM 2.5', 'PM 10', 'Ozone', 'Sulfure Dioxide', 'Nitrogen Dioxide'])
            .range([2.5, height])

        let healthBand = d3.scaleBand()
            .domain(['Asthma', 'Asthma ED visits (0-18 years)', 'Asthma ED visits (0-4 years)',
                           'Asthma ED Visits (65+ years)', 'Chronic lower respiratory disease deaths',
                           'Diagnosed heart disease', 'Hypertension', 'Lung cancer incidence',
                           'Screened or diagnosed with COPD'])
            .range([15, health_height])

        let healthRange = d3.scaleLinear()
            .domain([0, d3.max(zip_health, d => d.value)])
            .range([0, 90])

        let yAxis = d3.axisLeft(categoryScale);

        // visualization for pollution related metrics
        svg.append("g").selectAll("rect")
            .data(zip_pollution)
            .enter()
            .append("rect")
            .attr("x", 0)
            .attr("y", d => categoryScale(d.Metric))
            .attr("height", 20)
            .attr("width", d => chartScale(d.value))
            .attr("fill", "#B3DDF2")
            .attr("transform", "translate(90, 0)");

        svg.append("g").selectAll("rect")
            .data(limits)
            .enter()
            .append("rect")
            .attr("x", d => chartScale(d.value))
            .attr("y", d => categoryScale(d.AQG)-5)
            .attr("height", 30)
            .attr("width", 2)
            .attr("fill", "#FF0000")
            .attr("transform", "translate(90, 0)");

        svg.append("g")
            .attr("transform", "translate(90, -6)")
            .call(yAxis)
            .select(".domain").remove();

        // visualization for health related metrics
        svg2.append("g").selectAll("text")
            .data(zip_health)
            .enter()
            .append("text")
            .text(d => d.Metric)
            .style("font-size", "12px")
            .attr("x", 5)
            .attr("y", d => healthBand(d.Metric));

        svg2.append("g").selectAll("rect")
            .data(zip_health)
            .enter()
            .append("rect")
            .attr("fill", "steelblue")
            .attr("height", 10)
            .attr("width", d => healthRange(d.value))
            .attr("x", 0)
            .attr("y", d => healthBand(d.Metric))
            .attr("transform", "translate(0, 5)");

        svg2.append("g").selectAll("text")
            .data(zip_health)
            .enter()
            .append("text")
            .text(d => d.value)
            .style("font-size", "10px")
            .style("font-weight", "heavy")
            .attr("x", d => healthRange(d.value))
            .attr("y", d => healthBand(d.Metric))
            .attr("transform", "translate(5, 15)");
    });
</script>

</html>